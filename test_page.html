<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proofing Test 1</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #f9f9f9;
        }
        .container {
            background-color: #ffffff;
            width: 90%;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .title {
            font-size: 2em;
            color: #2196F3;
            font-weight: bold;
            text-align: left;
            margin-bottom: 20px;
        }
        .instructions {
            text-align: justify;
            line-height: 1.6;
        }
        .editable-box {
            border: 1px solid #ccc;
            padding: 10px;
            white-space: pre-wrap;
            font-family: Arial, sans-serif;
            font-size: 1em;
            line-height: 1.6;
            height: 600px;
            overflow: auto;
            background-color: #fdfdfd;
        }
        .timer {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 1.2em;
            font-weight: bold;
            color: red;
            background-color: #fff;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
        }
        .submit-btn {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
            background-color: black;
            color: white;
            border: none;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            width: 300px;
        }
        .modal-buttons button {
            margin: 10px;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Timer -->
    <div class="timer" id="timer">21:00</div>
    
    <!-- Page 1: Instructions -->
    <div class="container">
        <!-- Title -->
        <div class="title">PROOFING TEST 1</div>

        <!-- Instructions -->
        <div class="instructions">
            <p>Please read the following instructions carefully. Ensure you understand what is required before you begin. Following instructions is an important part of being a Toot Sweeter.</p>
            <p>Please proofread this letter. Check for errors in:</p>
            <ul>
                <li>Punctuation</li>
                <li>Spelling (NB: we prefer ‘-ise’ over the Oxford English ‘-ize’ endings)</li>
                <li>Capitalisation</li>
                <li>Individual and organisational names and details are fictitious, but still check the spelling.</li>
            </ul>
            <p>As our client is happy with the wording, the focus should be on proofing and picking up every single mistake you can.</p>
        </div>

        <!-- Project and Client Details -->
        <div class="project-details">
            <span>Project name:</span> Road Maintenance Contracts (RMCs)<br>
            <span>Client:</span> Road Engineering Services (RES)
        </div>
    </div>

    <!-- Page Break -->
    <div class="page-break"></div>

    <!-- Page 2: Editable Area -->
<div class="container">
    <div contenteditable="true" class="editable-box">
        <div style="text-align: right;">
            <p>
                Infrastructure Solutions Pty Ltd<br>
                ABN 12 345 678 910<br>
                307 George Street<br>
                Sydney<br>
                NSW 2000
            </p>
        </div>
        <div style="text-align: justify;">
            <p>14 July 2014<br><br>
            Ms Susan Anderson<br>
            Chief Executive<br>
            Road Engineering Services<br>
            Level 9, 101 Miller Street<br>
            North Sydney NSW 2060<br></p>

            <p>Dear Sir,<br></p>

            <p><b>REQUEST FOR PROPOSALS: ROAD MAINTENANCE CONTRACTS – Sydney (Ref: 37TRV)</b></p>

            <p>Infrastructure Solutions is pleased to submit our proposal for the Road Maintenance Contract (RMC).<br>  
            Our proposal includes:  
            <span style="color: red;">—</span> One original copy and five copies of our proposal, including the Pricing Schedules which have been presented in a separate volume.  
            <span style="color: red;">—</span> One electronic copy of our proposal in portable document format (PDF) on DVD, including the Pricing Schedules in PDF and MS Excel file formats, which are presented on a separate DVD.</p>

            <p>We welcome the chance to build on our work with RES after working together on the recent, successful Barkingheads Overpass and the Franklin Paradise Duplication projects that were delivered before time and under budget with no safety incidents. We specialize in road building and maintenance projects – we currently have 5 such projects in NSW including two in Sydney, worth collectively over AU$1 billion.</p>

            <p>We trust that our proposal is in accordance with the requirements of Road Engineering Services' request for proposals. If you require any additional information or clarification, please contact David Lee-Stephens, Bid Director on 0431 256 789 or david.lee-stevens@is.com.au.</p>

            <p>We look forward to meeting your program team at the upcoming Proponents’ Team Evaluation Workshop and to continue to work with RES to make NSW’s road infrastructure better, safer, and more reliable for everyone.</p>

            <p>Yours Sincerely,<br><br>
            Ms Gina Hollyford<br>
            Executive General Manager<br>
            Infrastructure Solutions</p>
        </div>
    </div>
</div>

        <button class="submit-btn" onclick="openModal()">Submit</button>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <p id="modal-message">Are you sure you want to submit?</p>
            <div class="modal-buttons">
                <button onclick="submitTest()">Yes</button>
                <button onclick="closeModal()">No</button>
            </div>
        </div>
    </div>

    <script>
        const timerDisplay = document.getElementById('timer');
        const modal = document.getElementById('modal');
        const modalMessage = document.getElementById('modal-message');
        let totalTime = 21 * 60; // Timer set to 21 minutes
        let remainingTime = totalTime;
        let timer;

        const urlParams = new URLSearchParams(window.location.search);
        const name = urlParams.get('name') || "Anonymous";
        const email = urlParams.get('email') || "unknown@example.com";

        function initializeTimer() {
            timer = setInterval(() => {
                const minutes = Math.floor(remainingTime / 60);
                const seconds = remainingTime % 60;

                timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' + seconds : seconds}`;
                remainingTime--;

                if (remainingTime < 0) {
                    clearInterval(timer);
                    alert("Time is up! Submitting the test automatically.");
                    submitTest();
                }
            }, 1000);
        }

        function openModal() {
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            modalMessage.textContent = `Are you sure you want to submit? You still have ${minutes}:${seconds < 10 ? '0' + seconds : seconds} left to finish your assessment.`;
            modal.style.display = 'flex';
        }

        function closeModal() {
            modal.style.display = 'none';
        }

        async function submitTest() {
            clearInterval(timer);

            const assessmentContent = document.querySelector('.editable-box').innerText.trim();
            const timeSpent = `${Math.floor((totalTime - remainingTime) / 60)} minutes ${remainingTime % 60} seconds`;

            if (!assessmentContent) {
                alert("The text box cannot be empty. Please edit the content before submitting.");
                return;
            }

            const payload = {
                name: name,
                email: email,
                edited_text: assessmentContent,
                time_spent: timeSpent
            };

            try {
                const response = await fetch('https://assessment-responses.onrender.com/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    alert("Your test has been submitted successfully!");
                    document.body.innerHTML = `
                        <div style="text-align: center; margin-top: 20%;">
                            <h1 style="font-size: 2.5em;">Thank you!</h1>
                            <p style="font-size: 1.2em;">Your assessment has been recorded.</p>
                        </div>
                    `;
                } else {
                    alert("Submission failed. Please try again.");
                }
            } catch (error) {
                alert(`An error occurred: ${error.message}`);
            }

            modal.style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', initializeTimer);
    </script>
</body>
</html>
